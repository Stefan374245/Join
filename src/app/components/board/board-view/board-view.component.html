<main class="board-container">
  <!-- Board Header -->
  <header class="board-header">
    <h1 class="board-title">Board</h1>

    <nav class="board-actions" aria-label="Board actions">
      <!-- Search Input -->
      <div class="search-wrapper" role="search">
        <input
          type="text"
          class="search-input"
          placeholder="Find Task"
          [(ngModel)]="searchQuery"
          (input)="onSearch()"
          aria-label="Search tasks"
        />
  <img src="assets/images/search.svg" alt="Search" title="Search" class="search-icon"/>
      </div>

      <button class="btn-add-task" (click)="openAddTaskModal()" aria-label="Add new task">
        <span>Add task</span>
  <img src="assets/images/add.svg" alt="Add" title="Add" class="add-icon" />
      </button>
    </nav>
  </header>

  <div class="board-loading" *ngIf="tasksLoading">
    <app-loading-spinner></app-loading-spinner>
  </div>
  <ng-container *ngIf="!tasksLoading">
    <section class="board-columns" aria-label="Task board columns">
      <section class="board-column" aria-labelledby="triage-heading">
        <header class="column-header">
          <h2 class="column-title" id="triage-heading">Triage</h2>
          <button class="btn-add-column-task"
                  (click)="openAddTaskModal('triage')"
                  (mouseenter)="onAddButtonHover($event, true)"
                  (mouseleave)="onAddButtonHover($event, false)"
                  aria-label="Add task to Triage">
            <img src="assets/images/taskPlus.svg" alt="Add task" title="Add task" role="presentation" />
          </button>
        </header>

        <div class="column-content"
             cdkDropList
             [cdkDropListData]="triageTasks"
             cdkDropListId="triage-list"
             (cdkDropListDropped)="onTaskDrop($event, 'triage')">
          <div class="no-tasks" *ngIf="triageTasks.length === 0" role="status">
          <p *ngIf="!tasksLoading">No tasks in triage</p>
          </div>

          <article class="task-card"
                   *ngFor="let task of triageTasks"
                   cdkDrag
                   [cdkDragData]="task"
                   [attr.data-task-id]="task.id"
                   (click)="openTaskDetail(task)">

            <div class="drag-placeholder" *cdkDragPlaceholder></div>

            <span class="task-category" [ngClass]="getCategoryClass(task.category)">
              {{ task.category }}
            </span>
            <h3 class="task-title">{{ task.title }}</h3>
            <p class="task-description">{{ getShortDescription(task.description) }}</p>

            <div class="task-progress" title="Subtask progress" aria-label="Subtask progress"
                 *ngIf="task.subtasks && task.subtasks.length > 0"
                 [ngClass]="{
                   'all-completed': areAllSubtasksCompleted(task),
                   'has-incomplete': hasIncompleteSubtasks(task)
                 }"
                 role="progressbar"
                 [attr.aria-valuenow]="getSubtaskProgress(task)"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 [attr.aria-label]="getCompletedSubtasks(task) + ' of ' + task.subtasks.length + ' subtasks completed'">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getSubtaskProgress(task)"></div>
              </div>
              <span class="progress-text">
                {{ getCompletedSubtasks(task) }}/{{ task.subtasks.length }} Subtasks
              </span>
            </div>

            <footer class="task-footer">
              <div class="task-assignees" role="list" aria-label="Assigned contacts">
                <div
                  class="assignee-avatar"
                  *ngFor="let userId of task.assignedTo.slice(0, 3)"
                  [style.background-color]="getContactColor(userId)"
                  role="listitem"
                  [attr.aria-label]="getContactInitials(userId)">
                  {{ getContactInitials(userId) }}
                </div>
                <div class="assignee-avatar more" *ngIf="task.assignedTo.length > 3" role="listitem">
                  +{{ task.assignedTo.length - 3 }}
                </div>
              </div>
              <div class="task-priority" [ngClass]="'priority-' + task.priority" [attr.aria-label]="task.priority + ' priority'">
                <img [src]="getPriorityIcon(task.priority)" [alt]="task.priority + ' priority'" [title]="task.priority + ' priority'" />
              </div>
            </footer>
          </article>
        </div>
      </section>

      <section class="board-column" aria-labelledby="todo-heading">
        <header class="column-header">
          <h2 class="column-title" id="todo-heading">To do</h2>
          <button class="btn-add-column-task"
                  (click)="openAddTaskModal('todo')"
                  (mouseenter)="onAddButtonHover($event, true)"
                  (mouseleave)="onAddButtonHover($event, false)"
                  aria-label="Add task to To do">
            <img src="assets/images/taskPlus.svg" alt="" role="presentation" />
          </button>
        </header>

        <div class="column-content"
             cdkDropList
             [cdkDropListData]="todoTasks"
             cdkDropListId="todo-list"
             (cdkDropListDropped)="onTaskDrop($event, 'todo')">
          <div class="no-tasks" *ngIf="todoTasks.length === 0" role="status">
          <p *ngIf="!tasksLoading">No tasks To do</p>
          </div>

          <article class="task-card"
                   *ngFor="let task of todoTasks"
                   cdkDrag
                   [cdkDragData]="task"
                   [attr.data-task-id]="task.id"
                   (click)="openTaskDetail(task)">

            <div class="drag-placeholder" *cdkDragPlaceholder></div>

            <span class="task-category" [ngClass]="getCategoryClass(task.category)">
              {{ task.category }}
            </span>
            <h3 class="task-title">{{ task.title }}</h3>
            <p class="task-description">{{ getShortDescription(task.description) }}</p>

            <div class="task-progress" title="Subtask progress" aria-label="Subtask progress"
                 *ngIf="task.subtasks && task.subtasks.length > 0"
                 [ngClass]="{
                   'all-completed': areAllSubtasksCompleted(task),
                   'has-incomplete': hasIncompleteSubtasks(task)
                 }"
                 role="progressbar"
                 [attr.aria-valuenow]="getSubtaskProgress(task)"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 [attr.aria-label]="getCompletedSubtasks(task) + ' of ' + task.subtasks.length + ' subtasks completed'">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getSubtaskProgress(task)"></div>
              </div>
              <span class="progress-text">
                {{ getCompletedSubtasks(task) }}/{{ task.subtasks.length }} Subtasks
              </span>
            </div>

            <footer class="task-footer">
              <div class="task-assignees" role="list" aria-label="Assigned contacts">
                <div
                  class="assignee-avatar"
                  *ngFor="let userId of task.assignedTo.slice(0, 3)"
                  [style.background-color]="getContactColor(userId)"
                  role="listitem"
                  [attr.aria-label]="getContactInitials(userId)">
                  {{ getContactInitials(userId) }}
                </div>
                <div class="assignee-avatar more" *ngIf="task.assignedTo.length > 3" role="listitem">
                  +{{ task.assignedTo.length - 3 }}
                </div>
              </div>
              <div class="task-priority" [ngClass]="'priority-' + task.priority" [attr.aria-label]="task.priority + ' priority'">
                <img [src]="getPriorityIcon(task.priority)" [alt]="task.priority + ' priority'" />
              </div>
            </footer>
          </article>
        </div>
      </section>

      <!-- In Progress Column --><section class="board-column" aria-labelledby="in-progress-heading">
        <header class="column-header">
          <h2 class="column-title" id="in-progress-heading">In progress</h2>
          <button class="btn-add-column-task"
                  (click)="openAddTaskModal('in-progress')"
                  (mouseenter)="onAddButtonHover($event, true)"
                  (mouseleave)="onAddButtonHover($event, false)"
                  aria-label="Add task to In progress">
            <img src="assets/images/taskPlus.svg" alt="" role="presentation" />
          </button>
        </header>

        <div class="column-content"
             cdkDropList
             [cdkDropListData]="inProgressTasks"
             cdkDropListId="in-progress-list"
             (cdkDropListDropped)="onTaskDrop($event, 'in-progress')">
          <div class="no-tasks" *ngIf="inProgressTasks.length === 0" role="status">
          <p *ngIf="!tasksLoading">No tasks in progress</p>
          </div>

          <article class="task-card"
                   *ngFor="let task of inProgressTasks"
                   cdkDrag
                   [cdkDragData]="task"
                   [attr.data-task-id]="task.id"
                   (click)="openTaskDetail(task)">

            <div class="drag-placeholder" *cdkDragPlaceholder></div>

            <span class="task-category" [ngClass]="getCategoryClass(task.category)">
              {{ task.category }}
            </span>
            <h3 class="task-title">{{ task.title }}</h3>
            <p class="task-description">{{ getShortDescription(task.description) }}</p>

            <div class="task-progress" title="Subtask progress" aria-label="Subtask progress"
                 *ngIf="task.subtasks && task.subtasks.length > 0"
                 [ngClass]="{
                   'all-completed': areAllSubtasksCompleted(task),
                   'has-incomplete': hasIncompleteSubtasks(task)
                 }"
                 role="progressbar"
                 [attr.aria-valuenow]="getSubtaskProgress(task)"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 [attr.aria-label]="getCompletedSubtasks(task) + ' of ' + task.subtasks.length + ' subtasks completed'">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getSubtaskProgress(task)"></div>
              </div>
              <span class="progress-text">
                {{ getCompletedSubtasks(task) }}/{{ task.subtasks.length }} Subtasks
              </span>
            </div>

            <footer class="task-footer">
              <div class="task-assignees" role="list" aria-label="Assigned contacts">
                <div
                  class="assignee-avatar"
                  *ngFor="let userId of task.assignedTo.slice(0, 3)"
                  [style.background-color]="getContactColor(userId)"
                  role="listitem"
                  [attr.aria-label]="getContactInitials(userId)">
                  {{ getContactInitials(userId) }}
                </div>
                <div class="assignee-avatar more" *ngIf="task.assignedTo.length > 3" role="listitem">
                  +{{ task.assignedTo.length - 3 }}
                </div>
              </div>
              <div class="task-priority" [ngClass]="'priority-' + task.priority" [attr.aria-label]="task.priority + ' priority'">
                <img [src]="getPriorityIcon(task.priority)" [alt]="task.priority + ' priority'" />
              </div>
            </footer>
          </article>
        </div>
      </section>

      <!-- Await Feedback Column -->
      <section class="board-column" aria-labelledby="await-feedback-heading">
        <header class="column-header">
          <h2 class="column-title" id="await-feedback-heading">Await feedback</h2>
          <button class="btn-add-column-task"
                  (click)="openAddTaskModal('await-feedback')"
                  (mouseenter)="onAddButtonHover($event, true)"
                  (mouseleave)="onAddButtonHover($event, false)"
                  aria-label="Add task to Await feedback">
            <img src="assets/images/taskPlus.svg" alt="" role="presentation" />
          </button>
        </header>

        <div class="column-content"
             cdkDropList
             [cdkDropListData]="awaitFeedbackTasks"
             cdkDropListId="await-feedback-list"
             (cdkDropListDropped)="onTaskDrop($event, 'await-feedback')">
          <div class="no-tasks" *ngIf="awaitFeedbackTasks.length === 0" role="status">
          <p *ngIf="!tasksLoading">No tasks awaiting feedback</p>
          </div>

          <article class="task-card"
                   *ngFor="let task of awaitFeedbackTasks"
                   cdkDrag
                   [cdkDragData]="task"
                   [attr.data-task-id]="task.id"
                   (click)="openTaskDetail(task)">

            <div class="drag-placeholder" *cdkDragPlaceholder></div>

            <span class="task-category" [ngClass]="getCategoryClass(task.category)">
              {{ task.category }}
            </span>
            <h3 class="task-title">{{ task.title }}</h3>
            <p class="task-description">{{ getShortDescription(task.description) }}</p>

            <div class="task-progress" title="Subtask progress" aria-label="Subtask progress"
                 *ngIf="task.subtasks && task.subtasks.length > 0"
                 [ngClass]="{
                   'all-completed': areAllSubtasksCompleted(task),
                   'has-incomplete': hasIncompleteSubtasks(task)
                 }"
                 role="progressbar"
                 [attr.aria-valuenow]="getSubtaskProgress(task)"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 [attr.aria-label]="getCompletedSubtasks(task) + ' of ' + task.subtasks.length + ' subtasks completed'">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getSubtaskProgress(task)"></div>
              </div>
              <span class="progress-text">
                {{ getCompletedSubtasks(task) }}/{{ task.subtasks.length }} Subtasks
              </span>
            </div>

            <footer class="task-footer">
              <div class="task-assignees" role="list" aria-label="Assigned contacts">
                <div
                  class="assignee-avatar"
                  *ngFor="let userId of task.assignedTo.slice(0, 3)"
                  [style.background-color]="getContactColor(userId)"
                  role="listitem"
                  [attr.aria-label]="getContactInitials(userId)">
                  {{ getContactInitials(userId) }}
                </div>
                <div class="assignee-avatar more" *ngIf="task.assignedTo.length > 3" role="listitem">
                  +{{ task.assignedTo.length - 3 }}
                </div>
              </div>
              <div class="task-priority" [ngClass]="'priority-' + task.priority" [attr.aria-label]="task.priority + ' priority'">
                <img [src]="getPriorityIcon(task.priority)" [alt]="task.priority + ' priority'" />
              </div>
            </footer>
          </article>
        </div>
      </section>

      <!-- Done Column -->
      <section class="board-column" aria-labelledby="done-heading">
        <header class="column-header">
          <h2 class="column-title" id="done-heading">Done</h2>
          <button class="btn-add-column-task"
                  (click)="openAddTaskModal('done')"
                  (mouseenter)="onAddButtonHover($event, true)"
                  (mouseleave)="onAddButtonHover($event, false)"
                  aria-label="Add task to Done">
            <img src="assets/images/taskPlus.svg" alt="" role="presentation" />
          </button>
        </header>

        <div class="column-content"
             cdkDropList
             [cdkDropListData]="doneTasks"
             cdkDropListId="done-list"
             (cdkDropListDropped)="onTaskDrop($event, 'done')">
          <div class="no-tasks" *ngIf="doneTasks.length === 0" role="status">
          <p *ngIf="!tasksLoading">No tasks done</p>
          </div>

          <article class="task-card"
                   *ngFor="let task of doneTasks"
                   cdkDrag
                   [cdkDragData]="task"
                   [attr.data-task-id]="task.id"
                   (click)="openTaskDetail(task)">

            <div class="drag-placeholder" *cdkDragPlaceholder></div>

            <span class="task-category" [ngClass]="getCategoryClass(task.category)">
              {{ task.category }}
            </span>
            <h3 class="task-title">{{ task.title }}</h3>
            <p class="task-description">{{ getShortDescription(task.description) }}</p>

            <div class="task-progress" title="Subtask progress" aria-label="Subtask progress"
                 *ngIf="task.subtasks && task.subtasks.length > 0"
                 [ngClass]="{
                   'all-completed': areAllSubtasksCompleted(task),
                   'has-incomplete': hasIncompleteSubtasks(task)
                 }"
                 role="progressbar"
                 [attr.aria-valuenow]="getSubtaskProgress(task)"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 [attr.aria-label]="getCompletedSubtasks(task) + ' of ' + task.subtasks.length + ' subtasks completed'">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getSubtaskProgress(task)"></div>
              </div>
              <span class="progress-text">
                {{ getCompletedSubtasks(task) }}/{{ task.subtasks.length }} Subtasks
              </span>
            </div>

            <footer class="task-footer">
              <div class="task-assignees" role="list" aria-label="Assigned contacts">
                <div
                  class="assignee-avatar"
                  *ngFor="let userId of task.assignedTo.slice(0, 3)"
                  [style.background-color]="getContactColor(userId)"
                  role="listitem"
                  [attr.aria-label]="getContactInitials(userId)">
                  {{ getContactInitials(userId) }}
                </div>
                <div class="assignee-avatar more" *ngIf="task.assignedTo.length > 3" role="listitem">
                  +{{ task.assignedTo.length - 3 }}
                </div>
              </div>
              <div class="task-priority" [ngClass]="'priority-' + task.priority" [attr.aria-label]="task.priority + ' priority'">
                <img [src]="getPriorityIcon(task.priority)" [alt]="task.priority + ' priority'" />
              </div>
            </footer>
          </article>
        </div>
      </section>
    </section>
  </ng-container>
</main>

<!-- Task Detail Overlay -->
<app-task-detail
  *ngIf="selectedTask"
  [task]="selectedTask"
  [isVisible]="showTaskDetail"
  (close)="closeTaskDetail()"
  (edit)="onEditTask($event)"
  (delete)="onDeleteTask($event)">
</app-task-detail>

<!-- Task Edit Overlay -->
<app-add-task
  *ngIf="showEditOverlay && taskToEdit"
  [isOverlay]="true"
  [taskToEdit]="taskToEdit"
  (close)="closeEditOverlay()"
  (taskSaved)="onTaskSaved($event)">
</app-add-task>

<!-- Add Task Overlay -->
<app-add-task
  *ngIf="showAddTaskOverlay"
  [isOverlay]="true"
  [initialStatus]="addTaskStatus"
  (close)="closeAddTaskOverlay()"
  (taskSaved)="onTaskCreated($event)">
</app-add-task>

